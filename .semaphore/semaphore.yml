version: v1.0
name: Initial Pipeline
agent:
  machine:
    type: e1-standard-2
    os_image: ubuntu1804
global_job_config:
  prologue:
    commands:
      - export SAMPLE_ENV_VAR=123abc
      - checkout
blocks:
  - name: Build App
    dependencies: []
    task:
      jobs:
        - name: Build
          commands: []
  - name: Test iOS
    dependencies:
      - Build App
    task:
      jobs:
        - name: Unit tests
          commands: []
        - name: Integration tests
          commands: []
    run:
      when: 'change_in(''/ios'', {default_branch: ''tf/two''})'
  - name: Test Android
    dependencies:
      - Build App
    task:
      jobs:
        - name: Unit tests
          commands: []
        - name: Integration tests
          commands: []
    run:
      when: 'change_in(''/android'', {default_branch: ''tf/two''})'
  - name: Test Linux
    dependencies:
      - Build App
    task:
      jobs:
        - name: Unit tests
          commands: []
        - name: Integration tests
          commands: []
    run:
      when: 'change_in(''/desktop'', {default_branch: ''tf/two''})'
  - name: Acceptance Tests Mobile
    dependencies:
      - Test Android
      - Test iOS
    run:
      when: 'change_in(''/ios'', {default_branch: ''tf/two''}) or change_in(''/android'', {default_branch: ''tf/two''})'
    task:
      jobs:
        - name: Run Tests
          commands: []
          parallelism: 4
  - name: Acceptance Tests Desktop
    dependencies:
      - Test Linux
    run:
      when: 'change_in(''/desktop'', {default_branch: ''tf/two''})'
    task:
      jobs:
        - name: Run Tests
          commands: []
          parallelism: 3
