version: v1.0
name: Continuous Integration Pipeline
agent:
  machine:
    type: f1-standard-2
    os_image: ubuntu2204
blocks:
  - name: Apt install
    dependencies: []
    task:
      jobs:
        - name: test version
          commands:
            - sudo apt update
            - sudo apt install -y openjdk-21-jdk
            - sudo update-java-alternatives --set /usr/lib/jvm/java-1.21.0-openjdk-amd64
            - java -version
promotions:
  - name: Prod
    pipeline_file: pipeline_3.yml
    deployment_target: Production
    auto_promote:
      when: result = 'passed'
  - name: Staging
    pipeline_file: pipeline_4.yml
    deployment_target: Staging
    auto_promote:
      when: result = 'passed'
