version: v1.0
name: Deploy
agent:
  machine:
    type: e1-standard-4
    os_image: ubuntu1804
blocks:
  - name: Generate Release
    dependencies: []
    task:
      jobs:
        - name: Run Semantic Release
          commands:
            - 'true'
  - name: Deploy iOS
    dependencies:
      - Generate Release
    task:
      agent:
        machine:
          type: a1-standard-4
          os_image: macos-xcode13
      env_vars:
        - name: LANG
          value: en_US.UTF-8
        - name: RUNNER_TEMP_PATH
          value: /Users/semaphore
      jobs:
        - name: Fastlane deploy
          commands:
            - 'true'
  - name: Deploy Android
    dependencies:
      - Generate Release
    task:
      agent:
        machine:
          type: e1-standard-4
          os_image: ubuntu2004
        containers:
          - name: main
            image: 'registry.semaphoreci.com/android:30-node'
      env_vars:
        - name: LANG
          value: en_US.UTF-8
        - name: RUNNER_TEMP_PATH
          value: /Users/semaphore
        - name: ROOT_PATH
          value: /root/YourProjectFolder
      jobs:
        - name: Fastlane deploy
          commands:
            - 'true'
